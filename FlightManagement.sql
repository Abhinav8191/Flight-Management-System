CREATE DATABASE AirlineManagement;
USE AirlineManagement;

DROP TABLE IF EXISTS SERVES;
DROP TABLE IF EXISTS PASSENGER_PHONE_NO;
DROP TABLE IF EXISTS PASSENGER;
DROP TABLE IF EXISTS TICKET;
DROP TABLE IF EXISTS EMP_PHONE_NO;
DROP TABLE IF EXISTS EMPLOYEE;
DROP TABLE IF EXISTS FLIGHT;
DROP TABLE IF EXISTS CONTAINS;
DROP TABLE IF EXISTS AIRLINE;
DROP TABLE IF EXISTS AIRPORT;

-- Create tables
CREATE TABLE AIRPORT (
    AIRPORT_NAME VARCHAR(20) NOT NULL,
    CITY VARCHAR(20),
    STATE VARCHAR(20),
    PRIMARY KEY (AIRPORT_NAME)
);

CREATE TABLE AIRLINE (
    AIRLINE_ID INT NOT NULL PRIMARY KEY,
    AIRLINE_NAME VARCHAR(10),
    AIRPORT_NAME VARCHAR(20),
    FOREIGN KEY (AIRPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME)
);

CREATE TABLE CONTAINS (
    AIRPORT_NAME VARCHAR(20),
    AIRLINE_ID INT,
    FOREIGN KEY (AIRPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME),
    FOREIGN KEY (AIRLINE_ID) REFERENCES AIRLINE(AIRLINE_ID)
);

CREATE TABLE FLIGHT (
    FLIGHT_NO INT NOT NULL,
    SOURCE VARCHAR(20) NOT NULL,
    DESTINATION VARCHAR(20) NOT NULL,
    D_TIME TIME,
    A_TIME TIME,
    DURATION INT NOT NULL,
    AIRLINE_ID INT,
    FOREIGN KEY (AIRLINE_ID) REFERENCES AIRLINE(AIRLINE_ID),
    PRIMARY KEY (FLIGHT_NO)
);

CREATE TABLE EMPLOYEE (
    E_ID INT NOT NULL,
    NAME VARCHAR(20),
    ADDRESS VARCHAR(20),
    SEX VARCHAR(10),
    SALARY INT,
    AGE INT,
    AIRPORT_NAME VARCHAR(20),
    FOREIGN KEY (AIRPORT_NAME) REFERENCES AIRPORT(AIRPORT_NAME),
    PRIMARY KEY (E_ID)
);

CREATE TABLE EMP_PHONE_NO (
    E_ID INT,
    PHONE_NO VARCHAR(11),
    FOREIGN KEY (E_ID) REFERENCES EMPLOYEE(E_ID)
);

CREATE TABLE TICKET (
    TICKET_NO VARCHAR(20) NOT NULL,
    AIRLINE_NAME VARCHAR(20) NOT NULL,
    PRICE INT NOT NULL,
    SEAT_NO VARCHAR(20),
    CLASS VARCHAR(5),
    D_TIME TIME,
    A_TIME TIME,
    DURATION INT,
    DESTINATION VARCHAR(20),
    SOURCE VARCHAR(20),
    PRIMARY KEY(TICKET_NO)
);

CREATE TABLE PASSENGER (
    PASSPORT_NO VARCHAR(20) NOT NULL,
    NAME VARCHAR(20) NOT NULL,
    ADDRESS VARCHAR(20),
    SEX VARCHAR(5),
    DOB DATE,
    AGE INT,
    FLIGHT_NO INT,
    TICKET_NO VARCHAR(20),
    FOREIGN KEY (FLIGHT_NO) REFERENCES FLIGHT(FLIGHT_NO),
    FOREIGN KEY (TICKET_NO) REFERENCES TICKET(TICKET_NO),
    PRIMARY KEY (PASSPORT_NO)
);

CREATE TABLE SERVES (
    E_ID INT,
    PASSPORT_NO VARCHAR(20),
    FOREIGN KEY (E_ID) REFERENCES EMPLOYEE(E_ID),
    FOREIGN KEY (PASSPORT_NO) REFERENCES PASSENGER(PASSPORT_NO)
);

CREATE TABLE PASSENGER_PHONE_NO (
    PASSPORT_NO VARCHAR(20),
    PHONE_NO VARCHAR(11),
    FOREIGN KEY (PASSPORT_NO) REFERENCES PASSENGER(PASSPORT_NO)
);

-- Insert data into the tables
INSERT INTO AIRPORT (AIRPORT_NAME, CITY, STATE) VALUES ('Shivaji', 'Mumbai', 'Maharashtra');
INSERT INTO AIRPORT (AIRPORT_NAME, CITY, STATE) VALUES ('Indira', 'Delhi', 'Delhi');
INSERT INTO AIRPORT (AIRPORT_NAME, CITY, STATE) VALUES ('Pune', 'Pune', 'Maharashtra');

INSERT INTO AIRLINE (AIRLINE_ID, AIRLINE_NAME, AIRPORT_NAME) VALUES (123, 'AirIndia', 'Shivaji');
INSERT INTO AIRLINE (AIRLINE_ID, AIRLINE_NAME, AIRPORT_NAME) VALUES (124, 'SpiceJet', 'Indira');

INSERT INTO FLIGHT (FLIGHT_NO, SOURCE, DESTINATION, D_TIME, A_TIME, DURATION, AIRLINE_ID) VALUES (12345, 'Mumbai', 'Delhi', '15:00:00', '17:00:00', 120, 123);
INSERT INTO FLIGHT (FLIGHT_NO, SOURCE, DESTINATION, D_TIME, A_TIME, DURATION, AIRLINE_ID) VALUES (12346, 'Delhi', 'Mumbai', '18:00:00', '20:00:00', 120, 124);

INSERT INTO EMPLOYEE (E_ID, NAME, ADDRESS, SEX, SALARY, AGE, AIRPORT_NAME) VALUES (1, 'John', 'Mumbai', 'M', 50000, 30, 'Shivaji');
INSERT INTO EMPLOYEE (E_ID, NAME, ADDRESS, SEX, SALARY, AGE, AIRPORT_NAME) VALUES (2, 'Jane', 'Pune', 'F', 60000, 25, 'Pune');

INSERT INTO EMP_PHONE_NO (E_ID, PHONE_NO) VALUES (1, '9876543210');
INSERT INTO EMP_PHONE_NO (E_ID, PHONE_NO) VALUES (2, '8765432109');

INSERT INTO TICKET (TICKET_NO, AIRLINE_NAME, PRICE, SEAT_NO, CLASS, D_TIME, A_TIME, DURATION, DESTINATION, SOURCE) VALUES ('T1', 'AirIndia', 5000, '12A', 'Economy', '15:00:00', '17:00:00', 120, 'Delhi', 'Mumbai');
INSERT INTO TICKET (TICKET_NO, AIRLINE_NAME, PRICE, SEAT_NO, CLASS, D_TIME, A_TIME, DURATION, DESTINATION, SOURCE) VALUES ('T2', 'SpiceJet', 4000, '15B', 'Economy', '18:00:00', '20:00:00', 120, 'Mumbai', 'Delhi');

-- Insert data into the PASSENGER table first than passenger ph no
INSERT INTO PASSENGER (PASSPORT_NO, NAME, ADDRESS, SEX, DOB, AGE, FLIGHT_NO, TICKET_NO) VALUES ('P123', 'Alice', '123 Main St', 'F', '1990-01-01', 30, 12345, 'T1');
INSERT INTO PASSENGER (PASSPORT_NO, NAME, ADDRESS, SEX, DOB, AGE, FLIGHT_NO, TICKET_NO) VALUES ('P124', 'Bob', '456 High St', 'M', '1985-02-02', 35, 12346, 'T2');


INSERT INTO PASSENGER_PHONE_NO (PASSPORT_NO, PHONE_NO) VALUES ('P123', '9876543211');
INSERT INTO PASSENGER_PHONE_NO (PASSPORT_NO, PHONE_NO) VALUES ('P124', '8765432110');


-- different queries
ALTER TABLE TICKET MODIFY COLUMN CLASS VARCHAR(10);

-- 	EXAMPLE QUERIES

-- Retrieve employee names and salaries for those with a phone number:
SELECT E.NAME, E.SALARY
FROM EMPLOYEE E
WHERE E.E_ID IN (
    SELECT EP.E_ID
    FROM EMP_PHONE_NO EP
    WHERE EP.E_ID = E.E_ID
);

-- Retrieve employee IDs, names, and salaries for employees with IDs in a specific list:
SELECT E.E_ID, E.NAME, E.SALARY
FROM EMPLOYEE E
WHERE E.E_ID IN (
    SELECT EP.E_ID
    FROM EMP_PHONE_NO EP
    WHERE EP.E_ID IN (1, 5)
);

-- Retrieve employee names and IDs for those working at airports in Mumbai:
SELECT E.NAME, E.E_ID
FROM EMPLOYEE E
WHERE E.AIRPORT_NAME IN (
    SELECT A.AIRPORT_NAME
    FROM AIRPORT A
    WHERE A.CITY = 'Mumbai'
);

-- Retrieve employee IDs, names, and genders for those with IDs greater than or equal to 3 and have a phone number:
SELECT E.E_ID, E.NAME, E.SEX
FROM EMPLOYEE E
WHERE E.E_ID IN (
    SELECT EP.E_ID
    FROM EMP_PHONE_NO EP
    WHERE E.E_ID = EP.E_ID AND EP.E_ID >= 3
);

-- Retrieve employee names and IDs for those who have more than one phone number:
SELECT E.NAME, E.E_ID
FROM EMPLOYEE E
WHERE E.E_ID IN (
    SELECT EP.E_ID
    FROM EMP_PHONE_NO EP
    GROUP BY EP.E_ID
    HAVING COUNT(*) > 1
);

-- Retrieve employee names, addresses, ages, and genders for those working at airports in Mumbai or Delhi:
SELECT E.NAME, E.ADDRESS, E.AGE, E.SEX
FROM EMPLOYEE E
WHERE E.AIRPORT_NAME IN (
    SELECT A.AIRPORT_NAME
    FROM AIRPORT A
    WHERE A.CITY IN ('Mumbai', 'Delhi')
);

-- Retrieve passenger names and passport numbers for those with tickets from 'AirIndia':
SELECT P.NAME, P.PASSPORT_NO
FROM PASSENGER P
WHERE P.TICKET_NO IN (
    SELECT T.TICKET_NO
    FROM TICKET T
    WHERE T.AIRLINE_NAME = 'AirIndia'
);

-- Retrieve passenger names and passport numbers for those with 'Economy' class tickets:
SELECT P.NAME, P.PASSPORT_NO
FROM PASSENGER P
WHERE P.TICKET_NO IN (
    SELECT T.TICKET_NO
    FROM TICKET T
    WHERE T.CLASS = 'Economy'
);

-- Retrieve names of passengers who have more than one phone number:
SELECT P.NAME
FROM PASSENGER P
WHERE P.PASSPORT_NO IN (
    SELECT PPN.PASSPORT_NO
    FROM PASSENGER_PHONE_NO PPN
    GROUP BY PPN.PASSPORT_NO
    HAVING COUNT(*) > 1
);

-- Retrieve passenger names, genders, and ticket numbers (incomplete query, assuming you want flights):
SELECT P.NAME, P.SEX, P.TICKET_NO
FROM PASSENGER P
WHERE P.FLIGHT_NO IN (
    SELECT F.FLIGHT_NO
    FROM FLIGHT F
);





